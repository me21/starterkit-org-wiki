#summary Перенос корневой ФС на SD.

== Введение ==

Пример разметки, форматирования SD карты и перенос на нее ФС собранной в buildroot. Модуль SK-SAM9G45-OEM загружается с microSD (разъем находится на самом модуле). 

== Разметка SD в fdisk ==

Все действия будем выполнять в консоли. При работе на виртуальной машине потребуется USB-кардридер. Чтобы диск обнаружился в гостевой ОС нужно разрешить для нее отображать USB-кардридер - нажать правую кнопку мышки на иконке с изображением USB-коннектора в правом нижнем углу окна в котором запущена виртуальная машина (третья по счету слева иконка) и отметить ваш кардридер, например у меня
{{{
USB Reaer USB Mass Storage Device [0201]
}}}
чтобы узнать название диска - смотрим выхлоп dmesg в терминале - нас интересуют последние записи
{{{
dmesg
...
[ 3474.733375] sd 4:0:0:0: Attached scsi generic sg2 type 0
[ 3474.765677] sd 4:0:0:0: [sdb] 15523840 512-byte logical blocks: (7.94 GB/7.40 GiB)
[ 3474.775780] sd 4:0:0:0: [sdb] Write Protect is off
[ 3474.775813] sd 4:0:0:0: [sdb] Mode Sense: 03 00 00 00
[ 3474.775827] sd 4:0:0:0: [sdb] Assuming drive cache: write through
[ 3474.824946] sd 4:0:0:0: [sdb] Assuming drive cache: write through
[ 3474.824978]  sdb: sdb1 sdb2
[ 3474.868309] sd 4:0:0:0: [sdb] Assuming drive cache: write through
[ 3474.868335] sd 4:0:0:0: [sdb] Attached SCSI removable disk
...
}}}
в данном случае мой диск - sdb с двумя первичными разделами sdb1, sdb2. Размонтируем диски (ОС по умолчанию автомонтирует разделы)
{{{
sudo umount /dev/sdb1
sudo umount /dev/sdb2
}}}
Удаляем таблицу разделов
{{{
sudo dd if=/dev/zero of=/dev/sdb bs=512 count=1 && sync
}}}
создаем новую таблицу разделов
{{{
sudo fdisk /dev/sdb
Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
Building a new DOS disklabel with disk identifier 0x9a024f28.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won't be recoverable.

Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

WARNING: DOS-compatible mode is deprecated. It's strongly recommended to
         switch off the mode (command 'c') and change display units to
         sectors (command 'u').

Command (m for help): 
}}}
смотрим какие есть команды 
{{{
Command (m for help): m
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)
}}}
смотрим нашу пустую таблицу разделов
{{{
Command (m for help): p

Disk /dev/sdb: 7948 MB, 7948206080 bytes
245 heads, 62 sectors/track, 1021 cylinders
Units = cylinders of 15190 * 512 = 7777280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x9a024f28

   Device Boot      Start         End      Blocks   Id  System
}}}
создаем первичный раздел 16M
{{{
Command (m for help): n
Command action
   e   extended
   p   primary partition (1-4)
p
Partition number (1-4): 1
First cylinder (1-1021, default 1): 
Using default value 1
Last cylinder, +cylinders or +size{K,M,G} (1-1021, default 1021): +16M

Command (m for help): 
}}}
создаем второй первичный раздел и отдаем под него все оставшееся свободное место
{{{
Command (m for help): n
Command action
   e   extended
   p   primary partition (1-4)
p
Partition number (1-4): 2
First cylinder (4-1021, default 4): 
Using default value 4
Last cylinder, +cylinders or +size{K,M,G} (4-1021, default 1021): 
Using default value 1021

Command (m for help): 
}}}