#summary Включение и использование watchdog-таймера.

= Введение =

Иногда возникает [http://starterkit.ru/html/index.php?name=forum&op=view&id=17679 необходимость использования watchdog]. Здесь описана последовательность действий для его включения для платы SK-MAT91SAM9G45.

= Настройка, специфичная для платы =

== Bootstrap ==

Таймер включается и выключается в bootstrap. В дальнейшем возможно только его использование. Для изменения состояния необходимо менять код загрузчика и [Bootstrap пересобирать] его.

=== AT91Bootstrap ===

Конфигурация, примерно как и для ядра, задаётся в board-файлах. В файле board/at91sam9g45ek/at91sam9g45ek.c надо закомментировать строку, отключающую watchdog:
{{{
    /*
     * Disable watchdog.
     */
    writel(AT91C_WDTC_WDDIS, AT91C_BASE_WDTC + WDTC_WDMR);
}}}
Как видно, она снабжена соответствующим комментарием.

При загрузке с SD AT91Bootstrap сам грузит ядро, так что, этого измененния достаточно.

=== sk_mat91sam9g45 bootstrap ===

Этот bootstrap используется для загрузки с NAND. Изменения надо вносить в at91lib/boards/at91sam9m10-ek/board_lowlevel.c:
{{{
    /* Watchdog initialization
     *************************/
#ifndef WDT_APP // Watchdog init in application ?
    AT91C_BASE_WDTC->WDTC_WDMR = AT91C_WDTC_WDDIS;
#endif
}}}
Тут тоже всё откомментировано и достаточно понятно. Строку достаточно закомментировать. Директивы препроцессора становятся не нужны, так что комментировать можно и их.

== U-Boot ==

[UBoot U-Boot], в рассматриваемом случае, используется только при загрузке с NAND. В принципе, сам по себе, этот загрузчик в процессе не участвует, но, при его работе, уже требуется регулярный сброс watchdog-таймера во избежание перезагрузки. U-Boot 2010.09, в принцие, содержит соответствующий код, но обнаружена, по крайней мере, [http://wiki.starterkit.ru/uboot одна проблема], как видно из [http://starterkit.ru/html/index.php?name=files&op=view&id=13 патча], касается это драйвера ATMEL DataFlash и, соответственно, должно проявляться при продолжительной работе с этим видом памяти.

= Общие настройки =

Далее описываются общие настройки ядра и системной утилиты сброса таймера.

== Ядро ==

== Watchdog ==