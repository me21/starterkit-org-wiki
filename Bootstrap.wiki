#summary Сборка bootstrap для плат на базе  at91sam9g45

= Введение =

Начальный загрузчик atmel bootstrap позволяет загружать ядро Linux напрямую (в последних версиях появилась поддержка Device tree), а также standalone код (включая u-boot) с различных внешних накопителей - SD, NAND (DataFlash на платах starterkit с процессором at91sam9g45 не используется).  

== AT91Bootstrap v3.0 ==

Последняя версия на момент описания 3.5.3, [http://repository.timesys.com/buildsources/a/at91bootstrap-3/at91bootstrap-3-3.5.3 оригинал]. Скачиваем оригинал (продублирован на googlecode.com)
{{{
mkdir -p ~/work
cd ~/work
wget http://starterkit-org.googlecode.com/files/at91bootstrap-3-3.5.3.tar.gz
tar xzvf at91bootstrap-3-3.5.3.tar.gz
}}}
Добавляем starterkit-специфичный патч - исправляет геометрию внешней памяти DDR2 и сброс аудиокодека AC97
{{{
wget http://starterkit-org.googlecode.com/files/at91bootstrap-3-3.5.3-sk.patch
cd at91bootstrap-3-3.5.3
patch -p1 < ../at91bootstrap-3-3.5.3-sk.patch
}}}
На данный момент конфигурация SDR не добавлена - bootsrap может быть использован с любым из вариантов плат на базе at91sam9g45.

== Конфигурация ==

В составе boostrap есть предопределенные конфиги, которые находятся в директории 
{{{
at91bootstrap-3-3.5.3/board/at91sam9m10g45ek
}}}
Перед конфигурацией и сборкой нужно указать КК через переменную окружения CROSS_COMPILE, например для [CrosstoolNg  кросскомпилятора] который вы собрали сами
{{{
CROSS_COMPILE=arm-atmel-linux-gnueabi-
}}}
Перед сборкой рекомендуется очистить дерево исходников от результатов предыдущей сборки
{{{
make mrproper
}}}

*Для загрузки ядра Linux с SD* напрямую (без u-boot)
{{{
make at91sam9m10g45eksd_linux_defconfig
}}}
После дефолтного конфига конфигурацию можно скорректировать под свои нужды
{{{
make menuconfig
}}}
Например изменить название имиджа ядра и параметры загрузки
{{{
Linux Image Storage Setup  --->
  (mem=64M console=ttyS0,115200 root=/dev/mmcblk0p2 rootwait) Linux kernel parameters
  (uImage) Binary Name on SD Card
}}}

*Для загрузки u-boot из NAND*
{{{
make at91sam9m10g45eknf_uboot_defconfig
}}}
Раскладка NAND на платах starterkit незначительно отличается от оригинальной atmel, нужно скорректировать адрес куда записан u-boot и размер раздела (имиджа)
{{{
make menuconfig
}}}
{{{
U-Boot Image Storage Setup  --->
  (0x00020000) Flash Offset for U-Boot
  (0x00040000) U-Boot Image Size
}}}